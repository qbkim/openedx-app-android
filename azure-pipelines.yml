trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  buildDir: '$(Build.SourcesDirectory)'

steps:
# üõ†Ô∏è Install Java 17 manually (since UseJava task is missing)
- script: |
    sudo apt-get update
    sudo apt-get install -y openjdk-17-jdk
    java -version
    echo "JAVA_HOME is set to $(which java)"
  displayName: 'Install Java 17'

# ‚úÖ Fix the conflicting SDK paths
- script: |
    echo "Unsetting ANDROID_SDK_ROOT to avoid SDK path conflict"
    unset ANDROID_SDK_ROOT
    export ANDROID_HOME=/opt/hostedtoolcache/AndroidSDK
    echo "ANDROID_HOME is set to $ANDROID_HOME"
    echo "JAVA_HOME is set to $JAVA_HOME"
    echo "Gradle Version:"
    ./gradlew --version
    echo "Android SDK Tools Version:"
    $ANDROID_HOME/tools/bin/sdkmanager --version
  displayName: 'Fix and Verify SDK Path'

# üîß Restore Gradle dependencies (optional but common)
- script: ./gradlew dependencies
  workingDirectory: $(buildDir)
  displayName: 'Restore Gradle Dependencies'

# üõ†Ô∏è Build the Android app
- task: Gradle@3
  inputs:
    gradleWrapperFile: '$(buildDir)/gradlew'
    workingDirectory: '$(buildDir)'
    options: '--console=plain --stacktrace'
    tasks: 'assembleDebug'
  displayName: 'Build Android App'

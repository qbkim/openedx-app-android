trigger:
  - main  # or your default branch

pool:
  vmImage: 'ubuntu-latest'

variables:
  ANDROID_HOME: $(Agent.ToolsDirectory)/AndroidSDK

steps:
# ✅ Set up Java 17
- task: JavaToolInstaller@0
  inputs:
    versionSpec: '17'
    jdkArchitecture: 'x64'

# ✅ Download and set up Android SDK
- script: |
    mkdir -p $ANDROID_HOME/cmdline-tools
    curl -sSL https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -o cmdline-tools.zip
    unzip -q cmdline-tools.zip -d $ANDROID_HOME/cmdline-tools
    mv $ANDROID_HOME/cmdline-tools/cmdline-tools $ANDROID_HOME/cmdline-tools/latest
  displayName: 'Download Android SDK'

# ✅ Install required Android packages
- script: |
    yes | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --sdk_root=$ANDROID_HOME \
      "platforms;android-33" \
      "build-tools;33.0.0" \
      "platform-tools"
  displayName: 'Install Android SDK Packages'

# ✅ Accept SDK licenses
- script: |
    yes | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --licenses
  displayName: 'Accept Android Licenses'

# ✅ Gradle Build
- task: Gradle@3
  inputs:
    gradleWrapperFile: 'gradlew'
    tasks: 'assembleDebug'
    options: '--stacktrace --info'
    publishJUnitResults: true
    testResultsFiles: '**/TEST-*.xml'
